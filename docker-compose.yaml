version: '3.8'

services:
  go2rtc:
    image: alexxit/go2rtc:latest
    restart: unless-stopped
    environment:
      - TZ=Asia/Bangkok
    ports:
      - "80:1984"
    command: >
      sh -c '
      mkdir -p /config &&
      echo "streams:" > /config/go2rtc.yaml &&
      echo "  sukhumvit:" >> /config/go2rtc.yaml &&
      echo "    - rtsp://ekkamaicam:$$CAMERA_PASSWORD@home.bangkokcam.com:8554/stream2" >> /config/go2rtc.yaml &&
      echo "api:" >> /config/go2rtc.yaml &&
      echo "  listen: \":1984\"" >> /config/go2rtc.yaml &&
      echo "webrtc:" >> /config/go2rtc.yaml &&
      echo "  listen: \":8555\"" >> /config/go2rtc.yaml &&
      /usr/local/bin/go2rtc
      '
